\begin{lstlisting}[style=scalaioScala]
def flajoletRte(leaves:Int):Rte =
  def recur(node:Node):Rte =
    weightedCase(
      (5, () => Star(recur(node))),
      (5, () => Not(recur(node)))),
      (90, () => node match {
        case InternalNode(_,left,right) =>
          weightedCase((34, () => Cat(recur(left), recur(right))),
                       (33, () => And(recur(left), recur(right))),
                       (33, () => Or( recur(left), recur(right))))
        case LeafNode() =>
          randElement(inhabitedLeaves)      }))

  val skeleton = balancedRandTree(leaves - 1)
  recur(skeleton)
\end{lstlisting}
