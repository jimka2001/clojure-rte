\documentclass[aspectratio=169]{beamer}
\beamertemplatenavigationsymbolsempty
\setbeamertemplate{footline}[frame number]
\usepackage{xspace}
\usepackage{pgf}
\usepackage{tikz}
\usetikzlibrary{patterns}
\usetikzlibrary{shapes.arrows}
\tikzstyle{accepting}=[accepting by double]
%%\tikzset{outer sep=2mm, accepting/.style={double distance=3.5mm}}
\usepackage{appendixnumberbeamer}
\usepackage{pgfplots}
\pgfplotsset{compat=1.16}
\usepackage{textcomp}
\usepackage{color}
\usepackage[subpreambles=true]{standalone}

\input{conj-colors}
\input{conj-commands}
\input{conj-listings}


\title{Balanced Sampling as a Tool for Useful PBT Random Tree Generation}
\author{Jim E. Newton\\and Ghiles Ziat}
\institute{EPITA Research Laboratory}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

%%\section{Motivation}

\begin{frame}{Motivation}
  \begin{itemize}
  \item<1->{ Testing (and in particular Property-Based Testing, PBT) requires generating randomized objects of a target type.}%
  \item<2->{ Select objects from an infinite set, $T$.

    \input{set-t}
  }%
  \item<3->{Selection should be \emph{surjective}.\\
    \Ie any conceivable object of the target type should be possible.}%
  \item<4->{Selection should be \emph{uniform}. \textcolor{gold}{controversial}\\
    \Ie, any two objects are equally likely.}
  \end{itemize}
\end{frame}

\begin{frame}{Motivation}
  \begin{itemize}
    \item<1->{Selecting surjectively and uniformly in $T$ may be difficult.}

    \item<2->{We may prefer to sample in another space $S$.}%      
    \item<2->{$f:S\to T$ ... and then convert object $s\in S$ to $f(s) = t \in T$.

    \input{map-s-to-t}
  }%
  \end{itemize}
\end{frame}
    

\begin{frame}{Motivation}
  \begin{itemize}
  \item<1->{Sadly uniform selection in $S$  may not deliver uniformity in $T$.
    \input{map-s-bias-to-t}}%
  \item<2->{OBSERVATION:  When we select $s\in S$ then generate $f(s)\in T$ we often find that $f(s)$ is  trivial.  }
  \item<3->{GOAL: improve uniformity in $T$ by biasing the selection in $S$.
    \input{map-s-to-t-bias}}%
  \end{itemize}
\end{frame}

\begin{frame}{Motivation}
CONCRETELY: uniformly sample Finite Automata by:
    \begin{enumerate}
    \item  Biased sample of Regular Expressions
    \item  Convert Regular Expression to Finite Automaton
    \end{enumerate}

    Uniform generation of Deterministic Finite Automata (DFA) is \textcolor{red}{difficult}.\\
    Conversion from RE to DFA is a  \textcolor{greeny}{solved problem}.

    \input{thought-balloon}%
\end{frame}



{\setbeamercolor{background canvas}{bg=toccolor}
\begin{frame}{Overview}
  \tableofcontents
\end{frame}
}

\section{What are Regular Type Expressions (RTEs), viewed as ASTs.}

{\setbeamercolor{background canvas}{bg=toccolor}
\begin{frame}

\Large What are Regular Type Expressions (RTEs), viewed as ASTs.
  
  \centering
  
  \includegraphics[width=0.9\textwidth]{regexp.png}

\end{frame}
}

\input{rtes}


\begin{frame}{RTE Library}
  \begin{itemize}
  \item RTE operations include union, intersection, complement, Kleene-star
  \item Habitation, Subset, Emptiness checks
  \item Membership check (RE-matching)
  \item Need to test RTE library
    \begin{itemize}
    \item Random generation of RTE/AST
    \end{itemize}
  \end{itemize}
\end{frame}

\newsavebox\examplegenrte
\begin{lrbox}{\examplegenrte}
  \begin{minipage}{12cm}
    \input{genrte}
  \end{minipage}
\end{lrbox}


\begin{frame}{\code{RTE} Abstract Data Type}
  \scalebox{0.9}{\input{rte-adt}}

\end{frame}


\begin{frame}{Generate a Random RTE/AST (depth-based)}
  \begin{columns}
    \begin{column}{0.35\textwidth}
      \scalebox{0.9}{\input{rte-adt-narrow}}
    \end{column}
    \begin{column}{0.60\textwidth}
  \usebox\examplegenrte
    \end{column}
  \end{columns}
\end{frame}


\section{How do RTEs relate to Deterministic Finite Automata (DFAs)?}
{\setbeamercolor{background canvas}{bg=toccolor}
\begin{frame}

\Large How do RTEs relate to Deterministic Finite Automata (DFAs)?

\centering

\scalebox{0.6}{\input{fig-3}}

\end{frame}
}

\input{re-match} % matching (a 1 1.0 b "a" "an" "the" -5 2 22 222 d 2/3)

\begin{frame}{DFA Library \code{xymbolyco}}
  Symbolic Finite Automata Library
  \begin{itemize}
    \item RTE to DFA
    \item DFA to RTE
    \item Pattern matching
    \item Minimization
    \item Union, Intersection, Emptiness check
    \item Need to test \code{xymbolyco}
    \begin{itemize}
    \item Random generation of DFA
    \end{itemize}

  \end{itemize}
\end{frame}

\section{Generating random DFA}
{\setbeamercolor{background canvas}{bg=toccolor}
\begin{frame}{Generating random DFA}

  \begin{itemize}
  \item We can construct DFA from RTE
  \item ... so generate random RTE (as seen earlier)
  \item ... and construct DFA
  \end{itemize}
  
\end{frame}
}

\begin{frame}{Successful: Generation of DFA from RTE}
  \begin{columns}
    \begin{column}{0.5\textwidth}
      \includegraphics[width=\textwidth, height=0.9\textheight, keepaspectratio]{balanced-rte}
    \end{column}
    \begin{column}{0.5\textwidth}
      \includegraphics[width=\textwidth, height=0.9\textheight, keepaspectratio]{balanced-dfa}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Dubious: Generation of DFA from RTE}
  \begin{columns}
    \begin{column}{0.4\textwidth}
      \includegraphics[width=\textwidth, height=0.9\textheight, keepaspectratio]{rte-naive-edge}
    \end{column}
    \begin{column}{0.6\textwidth}
      \begin{itemize}
      \item<1->{Trivial DFA. \includegraphics[width=3cm, keepaspectratio]{dfa-naive-edge}}
      \item<2->{Non-uniformity caused by so-called annihilators}
      \item<3->{Whenever an input $X=\emptyset$ then $X \cap Y = \emptyset$.}
      \item<4->{Thus entire tree generating $Y$ is \textcolor{red}{in vain.}}
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}





\begin{frame}{Proposed fix: Balanced Tree Generation}
  \begin{columns}[t]
    \begin{column}{0.4\textwidth}
      \textcolor{red}{UNIFORM\\ \emph{Portrait} --- narrow and deep}

      \centering
      
      \begin{minipage}{0.75\textwidth}
        \includegraphics[width=\textwidth, height=0.8\textheight, keepaspectratio]{rte-narrow-and-deep}
      \end{minipage}%
      
    \end{column}
    \begin{column}{0.6\textwidth}
      \textcolor{greeny}{BALANCED\\ \emph{Landscape} --- shallow and wide}

      \centering
      
      \begin{minipage}{0.85\textwidth}
        \includegraphics[width=\textwidth, height=0.6\textheight, keepaspectratio]{rte-shallow-and-wide}
      \end{minipage}%
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Requirements}
  \begin{itemize}

  \item If we want \emph{large} DFAs, we necessarily \textcolor{gold}{should} generate \emph{large} RTE (AST).

  \item However, this is not sufficient.  Many large RTEs generate small/trivial DFAs.

  \item We must generate \textcolor{greeny}{Portrait} not \textcolor{red}{Landscape} aspect ratios.
  \end{itemize}
\end{frame}




\section{Algorithms for Balanced Generation}
{\setbeamercolor{background canvas}{bg=toccolor}
\begin{frame}

\Large {Algorithms for Balanced Generation}
  
\end{frame}
}

\begin{frame}{Tree-Split Algorithm}{Divide and Conquer}

  To generate tree having $n$ leaves, find $p=pivot$ between 1 and
  $n$; build tree with $p$ leaves on left and $n-p$ leaves on right.
  Repeat recursively.
  \begin{columns}
    \begin{column}{.5\textwidth}
      \only<1>{\includegraphics[height=.8\textheight]{tree-split-1}}%
      \only<2>{\includegraphics[height=.8\textheight]{tree-split-2}}%
      \only<3>{\includegraphics[height=.8\textheight]{tree-split-3}}%
      \only<4>{\includegraphics[height=.8\textheight]{tree-split-4}}%
      \only<5>{\includegraphics[height=.8\textheight]{tree-split-5}}%
      \only<6->{\includegraphics[height=.8\textheight]{tree-split-6}}%
    \end{column}\hspace{-1cm}    
    \begin{column}{.5\textwidth}
      \only<7>{Question is how to produce the pivot?
        \begin{itemize}
        \item Gaussian
        \item Inverse Gaussian
        \item Linear
        \item Lopsided Comb
        \end{itemize}
      }
    \end{column}
  \end{columns}
\end{frame}



\newsavebox\clojtreesplitcore
\begin{lrbox}{\clojtreesplitcore}
  \begin{minipage}{15cm}
    \input{clojtreesplitcore}
  \end{minipage}
\end{lrbox}
\begin{frame}{RTE Tree-Split Generator}
  \usebox\clojtreesplitcore
\end{frame}

\newsavebox\clojtreesplit
\begin{lrbox}{\clojtreesplit}
  \begin{minipage}{15cm}
    \input{clojtreesplit}
  \end{minipage}
\end{lrbox}
\newsavebox\clojtreesplittwo
\begin{lrbox}{\clojtreesplittwo}
  \begin{minipage}{15cm}
    \input{clojtreesplit2}
  \end{minipage}
\end{lrbox}



\begin{frame}{RTE Tree-Split 4-variants}
  \only<1>{\usebox\clojtreesplit}%
  \only<2>{\usebox\clojtreesplittwo}
\end{frame}

\begin{frame}{Flajolet Algorithm}{Generate a Skeleton}

  Inserting 0 \ldots 9 in random order into Binary Search Tree: \code{[5 4 2 8 7 9 0 3 6 1]}
  \begin{columns}
    \begin{column}{.5\textwidth}
  \only<1>{\includegraphics[height=.8\textheight]{flajolet-1-5}}%
  \only<2>{\includegraphics[height=.8\textheight]{flajolet-2-45}}%
  \only<3>{\includegraphics[height=.8\textheight]{flajolet-3-245}}%
  \only<4>{\includegraphics[height=.8\textheight]{flajolet-4-2458}}%
  \only<5>{\includegraphics[height=.8\textheight]{flajolet-5-24578}}%
  \only<6>{\includegraphics[height=.8\textheight]{flajolet-6-245789}}%
  \only<7>{\includegraphics[height=.8\textheight]{flajolet-7-0245689}}%
  \only<8>{\includegraphics[height=.8\textheight]{flajolet-8-02345789}}%
  \only<9>{\includegraphics[height=.8\textheight]{flajolet-9-023456789}}%
  \only<10->{\includegraphics[height=.8\textheight]{flajolet-10-0123456789}}%
    \end{column}\hspace{-1cm}    
    \begin{column}{.5\textwidth}
      \only<11>{After generating skeleton, we fit an RTE to that skeleton.    }
    \end{column}
  \end{columns}
\end{frame}



\newsavebox\clojflajolet
\begin{lrbox}{\clojflajolet}
  \begin{minipage}{15cm}
    \input{clojflajolet}
  \end{minipage}
\end{lrbox}
\newsavebox\clojflajolettwo
\begin{lrbox}{\clojflajolettwo}
  \begin{minipage}{15cm}
    \input{clojflajolet2}
  \end{minipage}
\end{lrbox}
\begin{frame}{RTE Flajolet Generator}
  \only<1>{\usebox\clojflajolet}
  \only<2>{\usebox\clojflajolettwo}
\end{frame}


\section{Experimental Results}
{\setbeamercolor{background canvas}{bg=toccolor}
\begin{frame}

\Large {Experimental Results}
  
\end{frame}
}





%%%%%%%%%%%%%%%%%%%%%%
%%% Plots
%%%%%%%%%%%%%%%%%%%%%%

\input{used-plots}




\input{conclusion}

% \input{unused-plots}

\end{document}

% LocalWords:  surjective surjectively PBT EPITA Ghiles Ziat greeny
% LocalWords:  DFA toccolor RTEs ASTs Kleene xymbolyco RTE DFAs AST
% LocalWords:  keepaspectratio annihilators Flajolet
